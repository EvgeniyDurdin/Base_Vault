## Зачисление студентов
Рассмотрим, как происходит формирование списка абитуриентов, проходящих по конкурсу на образовательные программы. 
В таблицу **applicant_order** для пояснения включены столбцы «План набора» и «Результат». Каждая программа имеет свой план набора, например, план набора образовательной программы с **id** 1 – 2 человека.  Проходящими по конкурсу считаются первые два человека в списке  отсортированных по итоговому баллу абитуриентов, подавших заявление на  образовательную программу. Это абитуриенты с **id** 3 и 2. Аналогично отбираются абитуриенты на остальные образовательные программы. В таблице все проходящие по конкурсу выделены зеленым цветом.
![[Stepic_IntTr_3.4.1.png]]
Для отбора рекомендованных к зачислению студентов можно разработать различные алгоритмы. Мы реализуем несколько SQL запросов. В первом запросе вставим в таблицу **applicant_order** новый столбец для последовательной нумерации строк. 
Для изменения структуры таблицы используется оператор `ALTER TABLE`. С его помощью можно вставить новый столбец, удалить существующий, переименовать столбец и пр.
Для вставки нового столбца используется SQL запросы:
```sql
ALTER TABLE таблица ADD имя_столбца тип; - вставляет столбец после последнего
ALTER TABLE таблица ADD имя_столбца тип FIRST; - вставляет столбец перед первым
ALTER TABLE таблица ADD имя_столбца тип AFTER имя_столбца_1; - вставляет столбец после укзанного столбца
```
Для удаления столбца используется SQL запросы:
```sql
ALTER TABLE таблица DROP COLUMN имя_столбца; - удаляет столбец с заданным именем
ALTER TABLE таблица DROP имя_столбца; - ключевое слово COLUMN не обязательно указывать
ALTER TABLE таблица DROP имя_столбца,
                    DROP имя_столбца_1; - удаляет два столбца
```
Для переименования столбца используется  запрос (тип данных указывать обязательно):
```sql
ALTER TABLE таблица CHANGE имя_столбца новое_имя_столбца ТИП ДАННЫХ;
```
Для изменения типа  столбца используется запрос (два раза указывать имя столбца обязательно): 
```sql
ALTER TABLE таблица CHANGE имя_столбца имя_столбца НОВЫЙ_ТИП_ДАННЫХ;
```


## Нумерация строк
Номер строки в таблице или запросе в некоторых версиях SQL можно получить с помощью оконной функции  `row_number()`.  Когда создавался этот шаг версии SQL на платформе Stepik эта функция не поддерживалась. Сейчас версию изменили, оконные функции рассматриваются в следующем уроке.
На этом шаге нумерацию реализуем с помощью переменных.  Переменные задаются с помощью ключевого слова `SET`,  перед именем указывается символ `@`. Например, создадим переменную **@row_num** и присвоим ей значение 1:
```sql
SET @row_num := 1;
```
Теперь эту переменную можно использовать в запросах,  кроме того в запросах можно изменить ее значение. 
**Пример**
Пронумеруем записи в таблице **applicant_order**.
_Запрос:_
```sql
SET @row_num := 0;

SELECT *, (@row_num := @row_num + 1) AS str_num
FROM  applicant_order;
```
_Результат:_
```sql
+------------+-------------+------+---------+
| program_id | enrollee_id | itog | str_num |
+------------+-------------+------+---------+
| 1          | 3           | 235  | 1       |
| 1          | 2           | 226  | 2       |
| 1          | 1           | 219  | 3       |
| 2          | 6           | 276  | 4       |
| 2          | 3           | 235  | 5       |
| 2          | 2           | 226  | 6       |
| 3          | 6           | 270  | 7       |
| 3          | 4           | 239  | 8       |
| 3          | 5           | 200  | 9       |
| 4          | 6           | 270  | 10      |
| 4          | 3           | 247  | 11      |
| 4          | 5           | 200  | 12      |
+------------+-------------+------+---------+
```
**Пример**
Создадим нумерацию, которая начинается заново для каждой образовательной программы. Для этого можно использовать алгоритм, в котором в переменную **@row_num** заносится 1, если **id** программы в предыдущей записи не равен **id** программы в текущей:
-   объявить переменную **@num_pr**, задать ей начальное значение;
-   запомнить **id** образовательной программы для текущей записи в переменной **@num_pr**;
-   для следующей записи сравнить значение переменной **@num_pr** с **id** образовательной программы;
-   если они равны, то продолжить нумерацию `@row_num := @row_num + 1`;
-   в противном случае начать нумерацию снова, для этого установить `@row_num := 1`.
_Запрос:_
```sql
SET @num_pr := 0;
SET @row_num := 1;

SELECT *, 
     if(program_id = @num_pr, @row_num := @row_num + 1, @row_num := 1) AS str_num,
     @num_pr := program_id AS add_var 
from applicant_order;
```
_Результат:_
```sql
+------------+-------------+------+---------+---------+
| program_id | enrollee_id | itog | str_num | add_var |
+------------+-------------+------+---------+---------+
| 1          | 3           | 235  | 1       | 1       |
| 1          | 2           | 226  | 2       | 1       |
| 1          | 1           | 219  | 3       | 1       |
| 2          | 6           | 276  | 1       | 2       |
| 2          | 3           | 235  | 2       | 2       |
| 2          | 2           | 226  | 3       | 2       |
| 3          | 6           | 270  | 1       | 3       |
| 3          | 4           | 239  | 2       | 3       |
| 3          | 5           | 200  | 3       | 3       |
| 4          | 6           | 270  | 1       | 4       |
| 4          | 3           | 247  | 2       | 4       |
| 4          | 5           | 200  | 3       | 4       |
+------------+-------------+------+---------+---------+
```
**Пояснение**:
В `IF` можно делать операции над несколькими переменными, используя `AND`. То есть
```sql
IF(логическое_выражение, выражение AND выражение, выражение)
```